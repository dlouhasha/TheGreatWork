---
title: "Divorce and its Causes in the United Kingdom"
author: "Team M"
date: "October 13, 2017"
output:
  html_document:
    toc: yes
    toc_depth: '2'
  pdf_document:
    toc: yes
    toc_depth: 2
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, messages = FALSE, warning = FALSE)
```

```{r, eval = TRUE, echo=FALSE}
suppressPackageStartupMessages(library(dplyr, quietly=TRUE))
library(ggplot2)
suppressPackageStartupMessages(library(smbinning, quietly=TRUE))
suppressPackageStartupMessages(library(gridExtra, quietly=TRUE))
suppressPackageStartupMessages(library(stargazer, quietly=TRUE))
suppressPackageStartupMessages(library(readr, quietly=TRUE))
suppressPackageStartupMessages(library(RCurl, quietly=TRUE))
suppressPackageStartupMessages(library(foreign, quietly=TRUE))
suppressPackageStartupMessages(library(InformationValue, quietly=TRUE))

```

```{r}
# Load data
url <- "https://raw.githubusercontent.com/dlouhasha/TheGreatWork/master/data/filtered_dataset.csv"
filtered_data <- getURL(url)
filtered_data <- read.csv(textConnection(filtered_data))

fd <- filtered_data
fd <- as.data.frame(fd)

```


```{r, echo = FALSE}
# changing the factor names 
fd[, 'region'] <- factor(fd[,'region'], levels = c(1, 2, 3, 4, 5, 6, 7,
                                                       8, 9, 10, 11), 
                           labels = c('North East', 'North West', 'Yorkshire and the Humber', 
                                      'East Midlands', 'West Midlands', 'East of England', 
                                      'Inner London',
                                      'Outer London', 'South East', 'South West', 'Wales'))

fd <- fd %>% mutate('binary_region_num' = ifelse(region == 'Inner London', 1, 0)) %>% mutate( 'binary_region_factor' = ifelse(region == 'Inner London', "Inner London", "Outside London"))


fd[,'marstat'] <- factor(fd[,'marstat'], level = c(1,2,3,4,5,6), 
                           labels = c('Single', 'Married', 'Same-sex', 'Separated', 
                                      'Divorced', 'Widowed'))

fd <- mutate(fd, 'binary_marstat' = ifelse(marstat == "Separated" | marstat == 'Divorced', 1, 0))

fd[,'transport']<- factor(fd[,'transport'], levels = c(1, 2, 3, 4, 5, 6, 7,
                                                           8, 9, 10, 11), 
                            labels = c('Work from home', 'metro', 'Train', 'Bus',
                                       'Taxi', 'Motocycle', 'drive a car', 'passenger in a car', 
                                       'Bicycle', 'On foot', 'Other'))

fd[,'wpzhome'] <- factor(fd[,'wpzhome'], level = c(1,2,3,4,5), 
                           labels = c('Work from home', 'Same zone', 'Outside zone, but same LA/UA district',
                                      'Outside LA/UA/LGD', 'Workplace outside UK'))

fd[,'aggdtwpew11g'] <- factor(fd[,'aggdtwpew11g'], level = c(1, 2, 3, 4, 5, 6, 7,
                                                                 8, 9, 10, 11, 12), 
                                labels = c('less than 2km', '2-5', '5-10', '10-20', 
                                           '20-40', '40-60', '60 or more', 'at home', 
                                           'No fixed place', 'Outside England and Wales but in UK', 
                                           'Outside UK', 'Offshore but within UK'))

fd <- mutate(fd, Highest_qualification = hlqupuk11)
fd[,'Highest_qualification'] <- factor(fd[,'Highest_qualification'], 
                                            levels = c(10, 11, 12, 13, 14, 15, 16), labels = c('No qualification', 'Level 1', 'Level 2', 'Apprenticeship','Level 3', 'Level 4', 'Others'))

fd[,'hours']<- factor(fd[,'hours'], level= c(1,2,3,4), labels = c('15 or less', '16-30', '31-48','49 or more'))

fd[, 'tenure'] <- factor(fd[,'tenure'], levels = c(1, 2, 3, 4, 5), 
                           labels = c('Owns outright', 'Owns with a mortgage', 'Shared ownership', 'Rents', 'Rent-free'))

fd <- fd%>% mutate(no_of_children = dpcfamuk11)%>% mutate(children_class = ifelse(dpcfamuk11==1, '0.No children', ifelse(dpcfamuk11==2|dpcfamuk11==3|dpcfamuk11==4|dpcfamuk11==5|dpcfamuk11==6|dpcfamuk11==7, '1.One child', ifelse(dpcfamuk11==8|dpcfamuk11==9|dpcfamuk11==10|dpcfamuk11==11|dpcfamuk11==12|dpcfamuk11==13, '2.Two children', ifelse(dpcfamuk11==14|dpcfamuk11==15|dpcfamuk11==16|dpcfamuk11==17|dpcfamuk11==18|dpcfamuk11==19, '3.Three or more children', NA)))))

fd <- fd %>% mutate(youngest_child_age = ifelse(dpcfamuk11==1, '0.No children', ifelse(dpcfamuk11==2|dpcfamuk11==8|dpcfamuk11==14, '1.youngest aged 0-4', ifelse(dpcfamuk11==3|dpcfamuk11==9|dpcfamuk11==15, '2.youngest aged 5-7', ifelse(dpcfamuk11==4|dpcfamuk11==10|dpcfamuk11==16, '3.youngest aged 8-9', ifelse(dpcfamuk11==5|dpcfamuk11==11|dpcfamuk11==17, '4.youngest aged 10-11', ifelse(dpcfamuk11==6|dpcfamuk11==12|dpcfamuk11==18, '5.youngest aged 12-15', ifelse(dpcfamuk11==7|dpcfamuk11==13|dpcfamuk11==19, '6.youngest aged 16-18', NA))))))))

```


\newpage
# Introduction
Marriage is viewed by many as an important social and sometimes religious life event.  It symbolizes and unites two individuals into a single-family unit of everlasting bliss. Tragically, some marriages face the reality that they were not meant to last and either officially, through divorce or unofficially through separation. Since the United Kingdom separation rate hit its peak in 2003, it has steadily dropped by 34% to reach a low of 101,055 new divorces in 2015  (Haines, 2017; ONS).  This drop has been attributed to culture changes around cohabitation. Living together longer time before getting married makes one realise a mistake before big commitments are taken (Bingham, 2015). 

Despite the wonderful change in the overall separation rate, there are still many new divorces and separations each year leading us to wonder what could still cause such a travesty. The curiosity and ultimately investigation is to find the remaining factors still bringing about the decline and end of family units across the United Kingdom based on the 2011 Census data. 



# Description
The examined dataset is the 5% sample data of the 2011 UK Census. Census is a snapshot of the whole population taken every ten years through questionnaires. It covers many sociological topics including family life, education, health, living status, workplace and many more. 
The 5 % sample is representative containing 2,848,155 observations and 121 variables. Each observation represents an UK citizen.
Since the dataset contains a bigger ammount of variables than needed, only a fraction were exmained. The variable choice was partly based on previous research as well as intuitive estimation of factors which might influence the separation rate. A total of 15 variables, that may act as trigger for divorce, were selcted:

Individual ID
Marital status
Social grade
Highest education achieved
Age
Country of birth
Ethnic group
Religion
Region
Work hours per week
Long term health problems
Tenure of dwelling
Tenure of individual
Number of children


Divorce is a costly, emotionally involving and time consuming procedure. Many couples decide to break up, but do not take the legal step of the divorce for practical reasons. such as cohabitating and tax benefits. Those, not legally completed ruptures, fall under the category "separated". In most research paper those cases are not considered while looking at divorce rates. But, as divorce is not a nessessary following step of a break up and this analysis is particularly interested in the factors that lead to separation, seperated people were included in the analysis.

The dependend variable is separated, coded as 1 for separated and 0 for not separated. Singles (people who were never married) and widows were not included in the analysis, as they are not subject to divorce. Also children under 18 years were not included, as married teenager do not fall under the average divorced people and are therefore not interesting for the research. After filtering out irrelevant cases 1,330,073 observations were left.

In brief, the following paper aims at finding the main factors that may influence people's marriage and lead to seperation. The overall separation rate is 20 %, with 264,721 separated people versus 1,065,352 married people. 




# Methods 

Our toolset of packages are as shown below for purposes of data transformation and analysis.
```{r, echo = TRUE, eval = FALSE, results='hide', messages = FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(gridExtra)
library(stargazer)
library(readr)
library(RCurl)
library(foreign)
library(smbinning)
library(InformationValue)
```



The report aims to explore how selected variables singularly and collectively affect the probability of an individual being divorced or separated. 
All variables were crosschecked to make sure, they are true influence factor and do not act as confunding variable. For every influence factor theoretical hypothesis about the reason of the influence are made based on previous research from other scientific. 

In the first part of the report we explore the interactions between selected variables and separation rate. The second part consits of logistic regression model examining the prediction power of our selected variables. 
The separation rate is calculated as percentage of unhappy marriages over total marriages.

$$separationrate = (divorced + separated)/(married + samesex + divorced + separated)$$

Exploratory statistics were mostly performed with  plotting and crosschecking influencing variables under different circumstances and across different groups. As the dependend variable - seperation rate - is binary most correlation calculation (Pearson, Spearman, Goodman & Kruskal) and linear regession could not be performed to analyse the separation rate. 

To make sure observed patterns are statistically significant, the hypothesis' were tested with Chi-squared tests of independence as well as distribution and t-tests to compare average separation rates across different classes. The significance level in this research was set at 5 %.



# Descriptive data analysis


## Social grade, education and its influence on separation

Over time and geographical space, it has been shown various times that divorce rate differs reagrding education, social class and income. The higher educated and the higher the social class the lower the divorce rate. As the divorce rate in the UK has sunk by 34% in the last ten years, it should be checked if those purposes still hold (Office for National Statistics).

Social grade, a measure developped by the "National Readership Survey" should represent social class and income (It has been shown that social grade and income correlate highly). It is classified as follows: 

A	  Higher managerial, administrative and professional	
B	  Intermediate managerial, administrative and professional	
C1	Supervisory, clerical and junior managerial, administrative and professional	
C2	Skilled manual workers	
D	  Semi-skilled and unskilled manual workers
E	  State pensioners, casual and lowest grade workers, unemployed with state benefits only

In the original census data the social grades were grouped (AB, C1, C2, DE) and studends as well as people over 64 years old do not have a social grade and are therefore not included in the analysis.
The variable "Education" represents the highest education people achieved. Holder of non-british awards were not classified in the original data and therefore not included in the analysis, as their education level cannot be estimated.

The hypothesis underlying the following analysis claims a negative correlation between social class and divorce rate as well as education and divorce rate. 

```{r}
census <- filtered_data
census$ethnicityew <- factor(census$ethnicityew, levels = seq(1,18), labels = c("English/Welsh/Scottish/Northern Irish/British", 
"Irish", 
"Gypsy or Irish Traveller", 
"Other White", 
"Mixed/multiple ethnic group: White and Black Caribbean", 
"Mixed/multiple ethnic group: White and Black African", 
"Mixed/multiple ethnic group: White and Asian", 
"Mixed/multiple ethnic group: Other Mixed", 
"Indian", 
"Pakistani", 
"Bangladeshi", 
"Chinese", 
"Other Asian", 
"African", 
"Caribbean", 
"Other Black", 
"Arab", 
"Any other ethnic group"))

#1: white 2: Asian 3: black 4: Arab 5: other

census$ethngrouped <- census$ethnicityew

census$ethngrouped <- ifelse(census$ethnicityew == "English/Welsh/Scottish/Northern Irish/British"  | census$ethnicityew == "Irish" | census$ethnicityew == "Gypsy or Irish Traveller"| census$ethnicityew == "Other White", 1, 
                                ifelse( census$ethnicityew == "Indian" | census$ethnicityew == "Pakistani"| census$ethnicityew == "Bangladeshi" | census$ethnicityew == "Chinese"| census$ethnicityew == "Other Asian", 2, 
                                        ifelse(census$ethnicityew == "African" | census$ethnicityew == "Caribbean"| census$ethnicityew == "Other Black", 3, 
                                               ifelse(census$ethnicityew == "Arab", 4, 
                                                      ifelse(census$ethnicityew == "other", "Any other ethnic group", 5)))))


census$religionew <- factor(census$religionew, levels = seq(1,9), labels = c("No religion", 
"Christian", 
"Buddhist", 
"Hindu", 
"Jewish", 
"Muslim", 
"Sikh", 
"Other religion", 
"Not stated"))

census$region <- factor(census$region, levels = c(1, 2, 3, 4, 5, 6, 7,
                                                       8, 9, 10, 11), 
                           labels = c('North East', 'North West', 'Yorkshire and the Humber', 
                                      'East Midlands', 'West Midlands', 'East of England', 
                                      'Inner London',
                                      'Outer London', 'South East', 'South West', 'Wales'))

cen <- select(census, caseno, marstat, hlqupuk11, scgpuk11c)
cen$separated <- cen$marstat
cen <- cen %>% mutate(separated = replace(separated, marstat == 2 | marstat == 3, 0))
cen <- cen %>% mutate(separated = replace(separated, marstat == 5 | marstat == 4, 1))
colnames(cen) <- c("ID", "marstat", "education", "social_grade", "separated")
#replace -9 with NA 
cen_f <- cen %>% mutate_all(funs(replace(., . == -9, NA)))
cen_f <- cen_f %>% filter(!is.na(social_grade), !is.na(education), !(education == 16))

```


After filtering out people whose education level cannot be interpretated and filtering out missing values 1.684.636 observations are left. The overall divorce rate for the new filtered data is 21 %.
The distribution between social grades is alike. It has to be noted that social grade is coded 1 for the highest social level and 4 for the lowest. 
Education on the other hand has as significant underrepresentation of participants that absolved an apprenticeship. They account for less than 4 % of the surveyed participants . This should be kept in mind when interpreting divorcerates in the apprenticeship group.


Between education and social grade is a middle strong positive, linear correlation. The higher the education level the higher the social grade. But as social grade is built on many more factors than just education, it is insightful to look at both variables alone and combined, as they give different insights.

```{r, eval=FALSE, include=FALSE}
#quick look at distributions
table(cen_f$separated)
addmargins(prop.table(table(cen_f$separated)))
table(cen_f$education)
prop.table(table(cen_f$education))
```


```{r, eval=FALSE, include=FALSE}
#correlate independend variables 
social_plot <- ggplot(cen_f, aes(x = factor(education), y = social_grade))
social_plot +
  geom_histogram(stat = "summary", fun.y = "mean", fill = "cadetblue3") +
  xlab ("Education level") +
  ylab("Average social Grade (1:highest 4: lowest)") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


cen_f %>% group_by(education) %>% summarise(n = n(), mean_grade = mean(social_grade, na.rm = TRUE))

#Spearmans ran correlation coefficient (cor between two comparative variables)
cor(cen_f$social_grade, cen_f$education, method = "spearman", use="p")

```



```{r, echo=FALSE}

#Plot separation rate per social grade

educ <- cen_f %>% group_by(education) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100)

soclass <- cen_f %>% filter(!is.na(social_grade)) %>% group_by(social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100)

soclass_plot <- ggplot(soclass, aes(x = factor(social_grade), y = rel_div))
soclass_plot  +
  geom_col(fill  = "cadetblue3") +
  xlab("Social grade") +
  ylab("Separation rate in percent") +
  scale_x_discrete(labels = c("1" = "AB", "2" = "C1", "3" = "C2", "4" = "DE")) +
  scale_y_continuous(limits = c(0, 33), breaks = seq(0, 33, 5)) +
  ggtitle("Separation rate per social grade")

```


The divorce rates per social grades match the underlying hypothesis fundamentally. The higher the social grade, the lower the separation rate. 
Social grade is directly connected to living standarts. Society holds the common belief that money is the root of all marriage problems. Nevertheless, there a few studies supporting this theory and many contradicting it (Andersen, 2005). According to the UK census data, this assumption seems to prove true: the lowest social grade has an above average separation rate of 33 % versus 13 % for the upper and middle class. Only between social grade C1 and C2 the pattern does not apply. C2 has a 4% lower separation rate compared to C1. But still, both lie in the middle of AB and DE and are close to the total average separation rate of 21 %.

To see if the social grade is a true indicator for divorce and not only related to the fact, that migrants, different religions or higher educated, who tend to have a lower separation rate than the Britishs, are overrepresented in some social groups, the data was crosschecked with religion, ethnicity as well as education levels.  

The exact same pattern, also with the separation rate in  C1 being slightly higher than in C2 holds across all religions, ethnicities and education levels. It can be conlcuded, that social grade has a direct influence on the separation rate. Upper and middle class have a way lower probability of getting divorced than all other groups. Across all sociodemographic characteristics (religion, ethnicity, education levels) the lowest social grade always has a significantly higher separation rate and the highest social grade the lowest separation rate.

There are many explanations for that. A meaningful factor is the higher income associated with a higher social grade, which enables better housing, better healthcare, less stressful life, more security and therefore less severe problems affecting the average marriage. 
Next to monetary problems, lower social groups tend to have a higher probability of drug and alcohol problem, one of the major reasons for divorce (NHS 2014; Trail and Karney, 2012). Additionally, earlier marriages occuring often in low social calsses are a burden for marriages. As this is highly related to education it will be explained in the next paragraph. 

Overall it can be concluded that social grade, which is highly correlated with income, is a strong driver for divorces and therefore that strong fiancial problems drives people apart and a good financial situation keeps couples together.  
The difference between social grade C1 and C2, which is as well constant across different sociodemographic groups, is a question for further research and could not be evaluated based on the census data. 


## Education

 

```{r edu_plot, fig.width = 5, fig.height = 4}
#plot distribution of divorce per education level


#rel_div: percen_f_ft of divorce per education group
edu_plot <- ggplot(educ, aes(x = factor(education)))
edu_plot + 
  geom_col(aes(y = rel_div), fill = "cadetblue3") +
  geom_blank() +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, 3)) +
  ggtitle("Separation rate per education level") +
  xlab ("Education level") +
  ylab ("Separation rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
  
```


The graph clearly confirms the underlying expectations: the more highly educated an individual is, the lower the probability is for him to be either divorced or separated. As shown, the difference in separation rate between no degree and a university degree is about 10% (28% separation rate for people with no education and 17% for university graduates). The higher the school degree, the more the groups approach the mean separation rate of 21 %. 

A reason for the negative correlation directly linked to education, is that higher educated people marry later than less educated people. A reason for  marrying later the higher educated someone is, is that the education lasts longer and therefore "adult life" and a stable lifestyle starts later. More educated people tend to focus more on their career in their joung ages.  Especially for women, a higher education results in a higher independence which lowers her feeling of need for getting married early (Isen, 2010).
Additionally, higher educated people are in a relationship and live together longer time before getting married. Knowledge about the partner, expectations and security if both share the same ideas for the future grow with age and experienced with each other. Furthermore, being pregnant or having children is still a reason for early marriage which results in a higher separation rate. As less educated women tend to have children when they are younger, they marry earlier because of the child (Office for National Statistics, 2015).
 
A result from the higher education is a better financial situation which lowers the separation rate, as seen in the social grade analysis. As 80% of the people marry in their own social category, the gap between income and education between different couples grow even bigger (Sueddeutsche, 2015).
 
 By looking at the relation between divorce rate and education across different religions and ethnic groups, it can be seen that the negative correlation holds. Education therefore seems to be a driver for divorce independend of the religion and ethnicity.
This strong pattern diminishes when looking at the highest degree in every social group. The negative correlation is still present, but as education is highly unevenly distributed among social grades, social grade acts as a confuncing variable.
The strong pattern of a lower divorce rate in the social grade AB is partly driven by the majority of the people belonging to this social class being higly educated 

It can be concluded that both, education and social grade, are strong driver of divorce. The unequally distributed education levels within social classes reinforce this effect. 
The highest overall separation rate of 34% is thus in the lowest social grade group for people with no education at all. This effect is reinforced for black people in the lowest social grade with no education. Their separation rate is 37% on average. With a separation rate of only 6% highly educated Asians in the highest social grade hold the lowest separation rate. 
 
The average British person who is white, christian, belongs to the middle class, has a university degree, has 12% probability that he/she is divorced or separated. By only changing education (but keeping social class constant) the separation rate ascends to 14.5 %.
When looking for both education extremes in the lowest social class we get a separation rate for university graduates of 24 % versus 35 % for non-educated people. It can be seen by this, that social grade accounts for higher differences in separation rate than education does. 
 
 
```{r, eval=FALSE, include=FALSE}
educ <- cen_f %>% group_by(education, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))



#add seperation per social grade 

edu_plot <- ggplot(educ, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
edu_plot + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 35), breaks = seq(0, 35, 3)) +
  ggtitle("separation rate per education level") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#plot with facet_grid per social grade 
####
edu_plot <- ggplot(educ, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
edu_plot + 
  geom_col(stat = "identity") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 35), breaks = seq(0, 35, 2.5)) +
  ggtitle("separation rate per education level and social grade") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_grid(~social_grade)

#plot education per social grade, no separation rate
edu_plot <- ggplot(educ, aes(x = factor(education), y =n, fill = factor(social_grade)))
edu_plot + 
  geom_col(stat = "identity") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  ggtitle("separation rate per education level and social grade") +
  xlab ("Education level") +
  ylab ("Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_grid(~social_grade)
```




```{r}
educ <- cen_f %>% group_by(education, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))


#plot with facet_grid per social grade 
####
edu_plot <- ggplot(educ, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
edu_plot + 
  geom_col(stat = "identity") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 35), breaks = seq(0, 35, 5)) +
  ggtitle("Separation rate per education level and social grade") +
  xlab ("Education level") +
  ylab ("Separation rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_discrete(name="Social grade") +
  facet_grid(~social_grade)
```


```{r, include=FALSE}

cen <- select(census, caseno, marstat, hlqupuk11, scgpuk11c)
cen$separated <- cen$marstat
cen <- cen %>% mutate(separated = replace(separated, marstat == 2 | marstat == 3, 0))
cen <- cen %>% mutate(separated = replace(separated, marstat == 5 | marstat == 4, 1))
colnames(cen) <- c("ID", "marstat", "education", "social_grade", "separated")
#replace -9 with NA 
cen_f <- cen %>% mutate_all(funs(replace(., . == -9, NA)))
cen_f <- cen_f %>% filter(!is.na(social_grade), !is.na(education), !(education == 16))
dim(cen_f)

```


```{r, include=FALSE}
#cen_r: data set with regions to cross check 
cen_r <- select(census, caseno, marstat, hlqupuk11, scgpuk11c, region)

cen_r$separated <- cen_r$marstat
cen_r <- cen_r %>% mutate(separated = replace(separated, marstat == 2 | marstat == 3, 0))
cen_r <- cen_r %>% mutate(separated = replace(separated, marstat == 5 | marstat == 4, 1))
colnames(cen_r) <- c("ID", "marstat", "education", "social_grade", "region", "separated")
#replace -9 with NA 
cen_r <- cen_r %>% mutate_all(funs(replace(., . == -9, NA)))
cen_r <- cen_r %>% filter(!is.na(social_grade), !is.na(education), !is.na(region), !(education == 16))
dim(cen_f)

```


```{r, include=FALSE}
#Social grade education and region

region <- cen_r %>% group_by(region, education, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))


rp <- ggplot(region, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 45), breaks = seq(0, 45, 3)) +
  ggtitle("separation rate per education level and region") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ region)
```



```{r, include=FALSE}
#social grade per ethnicity


#1: white 2: Asian 3: black 4: Arab 5: other


###################### Social grade per ethnicity##################
#clean data 
cen_rel <- select(census, marstat, caseno, hlqupuk11, scgpuk11c, religionew, ethngrouped)
cen_rel$separated <- cen_rel$marstat
cen_rel <- cen_rel %>% mutate(separated = replace(separated, marstat == 2 | marstat == 3, 0))
cen_rel <- cen_rel %>% mutate(separated = replace(separated, marstat == 5 | marstat == 4, 1))
colnames(cen_rel) <- c("ID", "marstat", "education", "social_grade", "religion", "ethnicity", "separated")
#replace -9 with NA 
cen_rel <- cen_rel %>% mutate_all(funs(replace(., . == -9, NA)))
cen_rel <- cen_rel %>% filter(!is.na(social_grade), !is.na(education), !(education == 16), !is.na(religion), !(religion == "Not stated"))
dim(cen_rel)

#sort data
rel <- cen_rel %>% group_by(ethnicity, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))

#plot education and social grade depending on religion

rp <- ggplot(rel, aes(x = factor(social_grade), y = rel_div))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 3)) +
  ggtitle("separation rate per ethnicity and social grade") +
  xlab ("Social grade") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ ethnicity)

```

```{r, include=FALSE}
#separation rate per education level per ethnicity

rel <- cen_rel %>% group_by(ethnicity, education) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))

#plot education and social grade depending on religion

rp <- ggplot(rel, aes(x = factor(education), y = rel_div))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 3)) +
  ggtitle("separation rate per ethnicity and education level") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ ethnicity)


#1: white 2: Asian 3: black 4: Arab 5: other
```



```{r, include=FALSE}
#Education per religion



#sort data
rel <- cen_rel %>% group_by(religion, education) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))

#plot education and social grade depending on religion

rp <- ggplot(rel, aes(x = factor(education), y = rel_div))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 3)) +
  ggtitle("separation rate per religion and education") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ religion)
```



```{r, include=FALSE}
#separation rate per social grade and religion

rel <- cen_rel %>% group_by(social_grade, religion) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) 

rp <- ggplot(rel, aes(x = factor(social_grade), y = rel_div))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 3)) +
  ggtitle("separation rate per social grade") +
  xlab ("Social grade") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ religion)
```

```{r, include=FALSE}
reli <- cen_rel %>% group_by(religion) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) 


relp <- ggplot(reli, aes(x = religion, y = rel_div))
relp  +
  geom_col(fill  = "cadetblue3") +
  xlab("Religion") +
  ylab("separation rate in percent") +
  scale_y_continuous(limits = c(0, 40), breaks = seq(0, 40, 5)) +
  ggtitle("separation rate per religion")

```


```{r, include=FALSE}
#education per religion (too small sample for less represented religions)
  
#sort data
rel <- cen_rel %>% group_by(religion, education, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))

#plot education and social grade depending on religion

rp <- ggplot(rel, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 3)) +
  ggtitle("separation rate per education level") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ religion)
```



```{r, include=FALSE}
#social grade and education
#separation rate per social grade and education

region <- cen_r %>% group_by(education, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))


rp <- ggplot(region, aes(x = factor(social_grade), y = rel_div))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 45), breaks = seq(0, 45, 3)) +
  ggtitle("Separation rate per education level social grade") +
  xlab ("Social grade") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ education)
```



```{r, include=FALSE}
#average white person christ 

#sort data
white <- cen_rel %>% filter(religion == "Christian", ethnicity ==1, social_grade == 4, education == 10) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100)

```


## Age and Separation

Contains information about the age of the observation (person) in years. This variable ranges from 0 to 90 and is treated as a continuous variable. Ages 70, 75, 80, and 85 are clustered into groups each ranging 5 years (i.e. 70 through 74, 75 through 79, etc...). Furthermore, the 90 age group conatins ages 90 and above.

For the purposes of this analysis, and to calculate the divorce rate by age, the clustered age groups were equally distibuted among the number of ages the group contains. (e.g the 70 through 74 age group was divided into 5 seperate age groups 70, 71, 72, 73, and 74 each inherenting the parent group's divorce rate).
The density of age distribution was also checked to ensure that all age groups were represented fairly in the dataset. The results show, as expected, a fair representation.

The chart below shows the seperation rate for each of the 83 age groups (18 to 100). 
The age with the highest separation rate is 48. Likely causes of the observed peak may be the so-called seven-year itch or a couple's offsprings becoming of age and moving out. The shift in societal norms where staying in an un-happy marriage is no longer neccessary and where online dating and other activities are so readily available may also be another contributory factor (Prince Evans, 2017). 

This is further suported by the fact that younger people are less likely to be divorced, as those would be early-on in their marriages,while older people have a greater chance of being being remarried and thus will once again be classified as married according to the classifications in the UK census data. Additionally, although divorce rates for people above the age of 53 (Baby Boomers) are rising, this class of society generally has traditional values and beleif systems that consider marriage to be the norm. This, therefore, supports the idea that the marginal rate of divorce decreases above the age of 48 ( The Guardian, 2013). 

The sepration rate for observations aged 18 to 20 is significantly higher than observations in their 20's. The rationale for this observation is the scarcity (nominally) of married people who are 20 and less, which results in a large relative proportion of divorced people when compared to other age groups. The high divorce rate among young people can also be explained by the often painful and troubelsome reality of marriage. Young couples often rush into marriages on impulse without being prepared for marriage life, or are still very playful. Unexpected pre-marital pregnancy could be another reason for people marrying early, and that often result in divorce. Earlier researches have shown strong effects of premarital conception on chances of disruption (Wendy D. Manning). It is also correlated with education as explained earlier - people who are better educated tend to marry late (The Guardian, 2014).

From the data, it is apparent that the trend observed in the overall sample can also be observed when examining social grade groups or education levels, the divorce rate trends upwards from the lower ages and peaks in the late 40's, this trend then reverses with the divorce rate decreasing with age. These findings provide support the notion that divorce rate distibution by age seems to behave similarly regardless of other variables.

```{r}

data2 <-  fd 
#new dataframe containing the summarised count by age
total_group <- data2 %>% dplyr::select(age, binary_marstat) %>% group_by(age) %>% summarise(count = n())
total_group_full <- total_group[1:52,]
dummy1 <- data.frame(age = 70:100)
dummy1$count <- rep(1,31)
dummy1$count[1:5] <- rep(round(total_group$count[53] / 5), 5)
dummy1$count[6:10] <- rep(round(total_group$count[54] / 5), 5)
dummy1$count[11:15] <- rep(round(total_group$count[55] / 5), 5)
dummy1$count[16:20] <- rep(round(total_group$count[56] / 5), 5)
dummy1$count[21:31] <- rep(round(total_group$count[57] / 11), 11)
new_total_group <- rbind.data.frame(total_group_full, dummy1)

#create a new sub-data frame from data2 grouped by age and binary_marstat status and summarised 
divorced <-  data2 %>% dplyr::select(age, binary_marstat) %>% filter(binary_marstat == 1) %>% group_by(age, binary_marstat) %>% summarise(n = n()) %>% ungroup() %>% group_by(binary_marstat) %>% mutate(prop = n / sum(n) * 100)

#new divorced_full dataframe that contains all age groups above 70 i.e (70 to 100) since the orignal dataset groups ges above 70 by increments of 5. Count of divorced people was divided equally among the five tranches
divorced_full <- divorced[1:52,]
dummy <- data.frame(age = 70:100)
dummy$binary_marstat <- rep(1,31)
dummy$n <- rep(1,31)
dummy$prop <- rep(1,31)
dummy$n[1:5] <- rep(divorced$n[53] / 5, 5)
dummy$prop[1:5] <- rep(divorced$prop[53] / 5, 5)
dummy$n[6:10] <- rep(divorced$n[54] / 5, 5)
dummy$prop[6:10] <- rep(divorced$prop[54] / 5, 5)
dummy$n[11:15] <- rep(divorced$n[55] / 5, 5)
dummy$prop[11:15] <- rep(divorced$prop[55] / 5, 5)
dummy$n[16:20] <- rep(divorced$n[56] / 5, 5)
dummy$prop[16:20] <- rep(divorced$prop[56] / 5, 5)
dummy$n[21:31] <- rep(divorced$n[57] / 11, 11)
dummy$prop[21:31] <- rep(divorced$prop[57] / 11, 11)
new_divorced <- rbind.data.frame(divorced_full, dummy)

#create new data.frame to calculate the divorce rate per age. This is done by dividing the count of divorced people from divorced data frame by the respective rows from the total group data frame 
divorce_by_age <- data.frame(prop = c(1:83), age = new_divorced$age)
divorce_by_age$prop <- rep(1, 83)
divorce_by_age$prop <- new_divorced$n / new_total_group$count * 100

ggplot(data = divorce_by_age, aes(x = age, y = prop)) + geom_line(color = 'cadetblue3') + ylab("Divorce rate (%)") + xlab("Age") + ggtitle("Divorce rate by age")
```
```{r}
#creating a new dataframe grouped by age social grade and divorced status
data4 <- data2 %>% dplyr::select(age, scgpuk11c, binary_marstat) %>% filter(scgpuk11c != -9) %>% filter(binary_marstat == 1) %>% group_by(age, scgpuk11c, binary_marstat) %>% summarise(n = n())
data4_control <- data2 %>% dplyr::select(age, scgpuk11c) %>% filter(scgpuk11c != -9) %>% group_by(age, scgpuk11c) %>% summarise(n = n())
data4$divorce_rate <- data4$n / data4_control$n * 100
data4$scgpuk11c <- factor(data4$scgpuk11c, levels = c(1,2,3,4), labels = c("AB", "C1", "C2", "DE"))
ggplot(data = data4, aes(x = age, y = divorce_rate)) + geom_col(position = 'dodge', colour = 'cadetblue3') + facet_wrap(~scgpuk11c) + ylab("Divorce rate (%)") + xlab("Age") + ggtitle("Divorce rate distibution by age per social grade")

```

It may also be worth noting that the observed divorce rate among 50s and above is much higher in Inner London than elsewhere. This will be dicussed further in the sections to follow. 

## Region, geography and separation
An article on separation rate by region piqued our interests (http://www.dailymail.co.uk/news/article-3201497/Wish-weren-t-ten-divorce-hot-spots-Britain-sea-Blackpool-worst-place-live-want-happy-marriage.html). It lists the top 10 divorce hot spots and they are all coastal cities. The article states that the factors contributing to the high separation rate in coastal regions are due to the high deprivation and possibly sheer boredoem in winter. This section explores whether the Census data attests to the findings of that article. 

The plot shows a significant peak in the percentage of people in bad marriage in Inner London compared to elsewhere. This is the opposite to the aforementioned article. London is anything but a deprived and boring city. The hypothesis testing conducted further confirms that region and marital status are not independent, and particularly Inner London has a higher separation rate than elsewhere. Inner London has a separation rate of approximately 25.4%, higher than the average of 20 % in UK. In the following the focus shifts to explore factors causing such high separation rates in London. 

```{r, echo = FALSE}
# select the data relevant for region
region1 <- dplyr:: select(fd, binary_marstat, age, aggdtwpew11g, region, marstat, transport, wpzhome, Highest_qualification, binary_region_factor, binary_region_num,hours, tenure)

region_count<- region1 %>% select(marstat, region) %>% group_by(region, marstat)%>% summarise(count = n())%>% tidyr::spread(key = marstat, value = count) %>% mutate(divorce_rate = (Divorced + Separated)/(Divorced + Married + Separated))

```

```{r region_plot, fig.width=5,fig.height=4}
# plot separation rate for region
region_plot<-region1%>% group_by(region) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = region, y = divorce_rate*100))+ geom_col(fill = "cadetblue3") + theme(axis.text.x = element_text(angle = 30, hjust = 1)) + labs( title = "Separation rate by region", x = 'Region', y = 'Separation rate (%)') 
```

```{r, include=FALSE}
# chi-squared test
region_test <- region_count[,-1]
rownames(region_test) <- as.data.frame(region_count)[,1]
chi_region <- chisq.test(as.data.frame(region_test))
chi_region
round(chi_region$residuals, 3)
```

```{r region_ttest, echo = FALSE, eval=FALSE}
t.test(fd$binary_marstat, fd$binary_marstat[fd$region == "Inner London"])
```

```{r, include=FALSE}
#mean_London <- fdata$binary_marstat[fdata$region == "Inner London"]
outside_london <- fd$binary_marstat[fd$region != "Inner London"]

t.test(outside_london, fd$binary_marstat[fd$region == "North East"])
t.test(outside_london, fd$binary_marstat[fd$region == "North West"])
t.test(outside_london, fd$binary_marstat[fd$region == "Yorkshire and the Humber"])
t.test(outside_london, fd$binary_marstat[fd$region == "East Midlands"])
t.test(outside_london, fd$binary_marstat[fd$region == "West Midlands"])
t.test(outside_london, fd$binary_marstat[fd$region == "East of England"])
t.test(outside_london, fd$binary_marstat[fd$region == "Outer London"])
t.test(outside_london, fd$binary_marstat[fd$region == "South East"])
t.test(outside_london, fd$binary_marstat[fd$region == "South West"])
t.test(outside_london, fd$binary_marstat[fd$region == "Wales"])

```

Could the region where people live affect their marriage satisfaction, or is it merely an artifact as a result of other influencing factors? By plotting the separation rates against other variables and wrap them by region conclusion about the true influence of region can be made. 

After looking at the relationship between separation rate and education, social grade, hours worked per week, ethnicity, religion, housing type, number of children in the household, distance travelled to work and means of transport, the same pattern was identified between Inner London and the rest. Across all other groups and variables, Inner London still has a salient high separation rate. 

Interestingly, a significantly high separation rate for people aged 50 and above occures in Inner London. The population was further broken down into two groups: age below 50 and age 50 and above. For the group 50 and below there is no longer any significant difference in separation rates across regions. But the difference becomes more apparent in the second group. The divorce rate across all regions for the 50+ is 20 % compared to a divorce rate of 33 % for aged 50 and above living in Inner London). 

Two questions follow this observation: firstly why are there so many people getting divorced after 50s and secondly why Inner London?

According to Office for National Statistics, while the number of divorces drop by 28 % from 2005 to 2015, the number of men divorcing aged above 65 went up by 23 % and 38 % for women. Various factors contribute to the increasing separation rate among older people (Susan L. Brown and I-Fen Lin 18 Oct 2012). People getting more open-minded and receptive to divorce around them, higher economic independence, and more social interactions with people are among them. More significanty observed in their data is that people in higher order marriages are more likely to end up in divorces than people in first marriage (53.46% compared to 46.54%). And people in their 50s and 60s are also more likely to be in higher order marriages compared to younger people. Unfortunately information on order of marriages is abcent in our data. 

There is no empirical study on separation rates in different regions in UK, but we think the reasons mentioned above could all have contributed to the high separation rates in Inner London. However we must be careful not to confuse the status of being divorced or separated with the instance of getting a divorce. In our data we look at the percentage of people who are divorced or separated at the time of the survey, without information on when and where the divorce occured. It could also be possible that people in Inner London are less likely to remarry after they are divorced, just like London has the highest percentage of singles aged 30 and above. London is fun and people could be just having a good time being single or in relationships, without rushing into any marriage. We can conclude that there are more divorce and separated people living in London but not infer any causal relationship. Above all, London is the number one Tinder hotspots (thrillist.com, Nov 2015). 



```{r region_vs_others, echo = FALSE, eval= FALSE}
# separation rate by variables and wrapped by region

#separation rate by age 
fd %>% group_by(region, age) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = age, y = divorce_rate))+ geom_col() + facet_wrap(~region)

#separation rate by children_class
fd %>% filter(!is.na(children_class))%>% group_by(region, children_class) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = children_class, y = divorce_rate))+ geom_col() + facet_wrap(~region)+ theme(axis.text.x = element_text(angle = 60, hjust = 1))  

#separation rate by Highest_qualification
fd %>% filter(!is.na(Highest_qualification) & Highest_qualification != 'Others') %>%group_by(region, Highest_qualification) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = Highest_qualification, y = divorce_rate))+ geom_col() + facet_wrap(~region)+ theme(axis.text.x = element_text(angle = 60, hjust = 1)) 

#separation rate by hours worked
fd %>% filter(!is.na(hours)) %>%group_by(region, hours) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = hours, y = divorce_rate))+ geom_col() + facet_wrap(~region)+ theme(axis.text.x = element_text(angle = 60, hjust = 1))  

#separation rate by ethnicity
fd %>% filter(!is.na(ethnicityew)) %>%group_by(region, ethnicityew) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = ethnicityew, y = divorce_rate))+ geom_col() + facet_wrap(~region)+ theme(axis.text.x = element_text(angle = 60, hjust = 1))  

#separation rate by religion
fd %>% filter(!is.na(religionew)) %>%group_by(region, religionew) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = religionew, y = divorce_rate))+ geom_col() + facet_wrap(~region)+ theme(axis.text.x = element_text(angle = 60, hjust = 1))  

#separation rate by tenure
fd %>% filter(!is.na(tenure)) %>%group_by(region, tenure) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = region, y = divorce_rate))+ geom_col() + facet_wrap(~tenure)+ theme(axis.text.x = element_text(angle = 60, hjust = 1)) 

#separation rate by distance to work
fd %>% filter(!is.na(wpzhome)) %>%group_by(region, wpzhome) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = wpzhome, y = divorce_rate))+ geom_col() + facet_wrap(~region)+ theme(axis.text.x = element_text(angle = 60, hjust = 1))  
```

```{r region_graph_2agegroup}
#separation rate by region for aged below 50
plot49 <- region1%>% filter(age <50) %>% group_by(region) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = region, y = divorce_rate))+ geom_col(fill = "cadetblue3") + theme(axis.text.x = element_text(angle = 30, hjust = 1)) + labs( title = "aged below 50", x = 'Region', y = 'separation rate (%)')

#separation rate by region for aged 50 and above
plot50 <- region1%>% filter(age >=50) %>% group_by(region) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = region, y = divorce_rate))+ geom_col(fill = "cadetblue3") + theme(axis.text.x = element_text(angle = 30, hjust = 1)) + labs( title = "aged 50 and above", x = 'Region', y = 'separation rate (%)')

require(gridExtra)
grid.arrange(region_plot, plot49, plot50, ncol=3)
```

```{r, echo = FALSE, eval = FALSE}
#t-test for difference in separation rate in people aged above 50 across regions 
above50 <- filter(fd, age >= 50)
t.test(above50$binary_marstat, above50$binary_marstat[above50$region == "Inner London"])


# separation rate by age and wrapped by regions
fd %>% group_by(region, age) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = age, y = divorce_rate * 100))+ geom_col() + facet_wrap(~region) + labs( title = "separation rate by region", x = 'Region', y = 'separation rate (%)')


#distribution of age wrapped by region
fd %>% filter(!is.na(age))%>% ggplot(aes(x = age))+ geom_histogram() + facet_wrap(~region)


```




## Religion and Culture & Marriage


It cannot be denied that the cultural package each person carries, is a major factor in his conception of marriage, his expectations toward a relationship and his values about separation. The tests we conduct further show that martial status and religion, ethnicity and country of birth are not independent. However the exact relationships are not clear and there isn't enough empirical research on this topic, thus this part of the analysis, examines the factors of Ethnicity, Religion and Country of birth to try to determine the effect it has on separation rate. 


```{r, echo=FALSE, message = FALSE}

myowndata <- fd %>% select(marstat, binary_marstat, cobg, ethnicityew, religionew)

```

```{r, echo = FALSE}
# Factoring Data

myowndata[, 'cobg'] <- factor(myowndata[, 'cobg'], levels = seq(1,26), labels = c("England","Scotland", "Northern Ireland", "Wales", "United Kingdom not otherwise specified", "Ireland", "Germany", "Poland", "Other EU countries: Member countries in 2001", "Other EU countries: Accession countries 2001 to 2011", "Rest of Europe", "North Africa", "Central and Western Africa", "South and Eastern Africa", "Africa not otherwise specified", "Middle East", "Eastern Asia", "Southern Asia: Bangladesh", "Southern Asia: India", "Southern Asia: Pakistan", "Rest of Southern Asia", "South-East Asia", "Central Asia", "North America and the Caribbean", "Central and South America", "Antarctica, Oceania and other"))


#myowndata[, 'binary_marstat'] <- factor(myowndata[, 'binary_marstat'], levels = c(1,0), labels = c("Separated/Divorced","Married/In a relationship"))


myowndata[, 'ethnicityew'] <- factor(myowndata[, 'ethnicityew'], levels = seq(1,18), labels = c("English/Welsh/Scottish/Northern Irish/British", "Irish", "Gypsy or Irish Traveller", "Other White", "Mixed/multiple ethnic group: White and Black Caribbean", "Mixed/multiple ethnic group: White and Black African", "Mixed/multiple ethnic group: White and Asian", "Mixed/multiple ethnic group: Other Mixed", "Indian", "Pakistani", "Bangladeshi", "Chinese", "Other Asian", "African", "Caribbean", "Other Black", "Arab", "Any other ethnic group"))


myowndata[, 'religionew'] <- factor(myowndata[, 'religionew'], levels = seq(1,9), labels = c("No religion", "Christian", "Buddhist", "Hindu", "Jewish", "Muslim", "Sikh", "Other religion", "Not stated"))


myowndata <- na.omit(myowndata)


myowndata$ethngrouped <- ifelse(myowndata$ethnicityew == "English/Welsh/Scottish/Northern Irish/British"  | myowndata$ethnicityew == "Irish" | myowndata$ethnicityew == "Gypsy or Irish Traveller"| myowndata$ethnicityew == "Other White", "White", 
                                ifelse( myowndata$ethnicityew == "Indian" | myowndata$ethnicityew == "Pakistani"| myowndata$ethnicityew == "Bangladeshi" | myowndata$ethnicityew == "Chinese"| myowndata$ethnicityew == "Other Asian", "Asian", 
                                        ifelse(myowndata$ethnicityew == "African" | myowndata$ethnicityew == "Caribbean"| myowndata$ethnicityew == "Other Black", "Black", 
                                               ifelse(myowndata$ethnicityew == "Arab", 'Arab', 
                                                      ifelse(myowndata$ethnicityew == "Any other ethnic group", "Any other", "Mix Group")))))
    
                                                      
myowndata$cobggrouped <- ifelse(myowndata$cobg == "England" | myowndata$cobg == "Scotland"| myowndata$cobg == "Northern Ireland"  | myowndata$cobg =="Wales"  | myowndata$cobg =="United Kingdom not otherwise specified" , "UK", 
                         ifelse(myowndata$cobg =="Ireland" | myowndata$cobg =="Germany"  | myowndata$cobg  =="Poland"  | myowndata$cobg  =="Other EU countries: Member countries in 2001"  | myowndata$cobg  =="Other EU countries: Accession countries 2001 to 2011"  | myowndata$cobg  =="Rest of Europe", "Europe",
                                ifelse( myowndata$cobg  == "Middle East" | myowndata$cobg  == "Eastern Asia" | myowndata$cobg  == "Southern Asia: Bangladesh" | myowndata$cobg  == "Southern Asia: India" | myowndata$cobg  == "Southern Asia: Pakistan" | myowndata$cobg  == "Rest of Southern Asia" | myowndata$cobg  == "South-East Asia" | myowndata$cobg  == "Central Asia", "Middle East and Asia", 
                                        ifelse(myowndata$cobg  ==  "North Africa" | myowndata$cobg  == "Central and Western Africa" | myowndata$cobg  == "South and Eastern Africa" | myowndata$cobg  == "Africa not otherwise specified", "Africa", 
                                               ifelse(myowndata$cobg  == 'North America and the Caribbean' | myowndata$cobg  == 'Central and South America', 'The Americas and the Caribbean', 'Antarctica, Oceania and other')))))
		                                                      
```


```{r, echo = FALSE, eval=FALSE}
# Chi-Square Test
chisq.test(myowndata$cobg, myowndata$binary_marstat)
chisq.test(myowndata$ethnicityew, myowndata$binary_marstat)
chisq.test(myowndata$religionew, myowndata$binary_marstat)
```


```{r, echo = FALSE, message=FALSE, warning=FALSE}
ethngrouped <- dplyr::select(myowndata, binary_marstat, ethnicityew, ethngrouped) %>% group_by(ethngrouped, binary_marstat) %>% summarise(count = n()) %>% ungroup() %>% group_by(ethngrouped) %>% mutate(prop = count/ sum(count)*100) %>% filter(binary_marstat == "Separated/Divorced")
```

```{r, echo = FALSE, message=FALSE, warning=FALSE, eval=FALSE}
# Looking the etnicities in detail

ethn <- dplyr::select(myowndata, binary_marstat, ethnicityew, ethngrouped) %>% group_by(ethnicityew, binary_marstat) %>% summarise(count = n()) %>% ungroup() %>% group_by(ethnicityew) %>% mutate(prop = count/ sum(count)*100)  %>% filter(binary_marstat == "Separated/Divorced")

myowndata %>%group_by(ethngrouped) %>% summarise(divorce_rate = mean(binary_marstat*100))%>% ggplot(aes(x = ethngrouped, y = divorce_rate))+ geom_col(fill = "cadetblue3") + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = "Ethnic Groups", y = "Separation rate (%)", title = "Separation rate by Ethnicity")

```

```{r, echo = FALSE, message=FALSE, warning=FALSE}
cbgrouped <- myowndata %>% dplyr::select(binary_marstat, cobggrouped) %>% group_by(cobggrouped, binary_marstat) %>% summarise(grouped_count = n()) %>% ungroup() %>% group_by(cobggrouped) %>% mutate(prop = grouped_count/ sum(grouped_count) *100) %>% filter(binary_marstat == "Separated/Divorced")

```

The separation rate of Asians is the lowest among all ethnicities with a percentage of 9.5%. This can be explained by Asian cultural values on marriage and family. Marriage in Asia is considered an accomplisment, and even if divorce has become more socially accepted, dissolution of marriage still carries profound stigma, leading to disapproving and devaluing attitudes. As a consequence, arranged marriages without cohabiation are still taking place in some Asian communities, which actually make divorce less likely for the couples (Cultural Sociology of Divorce: An Encyclopedia). 

As expected, the separation rate is also very high among mixed ethnicities person (29.2%), likely caused by cultural conflicts. Besides, mixed race people are less committed toward religion as the data shows in the figure (7% of mixed race people have no religion) and as abserved the group with no religion has the second highest separation rate after other religion . Each of these factors makes divorce more likely for the interracial couple (divorcesource, 2016).

However, one more unexpected result is that separation rate are the highest among black people with 30.5%. Another reason for this discrepancy between African and European culture may be that women in Africa are treated as inferior to men, and confine themselves to domestic role. In the UK, women have the same rights as men, both socially and economically, giving them more independance and possibly leading to frictions. Thus, the changing role of women, ideational shifts, greater access to the legal system, and new possibilities for meeting and (re)partnering may have led to this high rate of separation.

Finally, the data highlights stark differences in marriage patterns between ethnic groups, (with a separation ratio three times higher from a ethnic group to another), enhanced by the different cultural values. 

```{r, echo = FALSE, message=FALSE, warning=FALSE}
relig <- myowndata %>% dplyr::select(binary_marstat, religionew, ethngrouped) %>% group_by(ethngrouped, binary_marstat, religionew) %>% summarise(count = length(binary_marstat)) %>% ungroup() %>% group_by(ethngrouped) %>% mutate(prop = count / sum(count) *100) %>% filter(religionew == 'No religion') %>% filter(binary_marstat == "Separated/Divorced")
```

```{r, echo = FALSE, message=FALSE, warning=FALSE}
relig <- myowndata %>% dplyr::select(binary_marstat, religionew, ethngrouped) %>% group_by(ethngrouped, binary_marstat, religionew) %>% summarise(count = length(binary_marstat)) %>% ungroup() %>% group_by(ethngrouped) %>% mutate(prop = count / sum(count)) 

relig_divorced = filter(relig, binary_marstat == "Separated/Divorced")

plot_religion <- myowndata %>% filter (!(religionew == "Not stated")) %>% group_by(religionew) %>%summarise(divorce_rate = mean(binary_marstat*100))%>% ggplot(aes(x = religionew, y = divorce_rate))+ geom_col(fill = "cadetblue3") + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = "Religion", y = "Separation rate (%)", title = "Separation rate by Religion")
plot_religion

```

The initial assumption is that separation rate will be higher among atheists who are generally considered to have values less bounded to marriage, and more lax laws for divorce. It is expected that the less commited people are towards religion, the more they are likely to get separated. Religions like Buddhism and Sikh are more involving religions, generally practiced with more commitment than christianity is. 
The plot shows an above average divorce rate of 25 % fo people with no religion. Other religions show an even higher divorce rate, but unfortunalty the Census data set does not give any information about this group. Hindus have the lowest divorce rate, which can be explained by the fact, that in Hinduism divorce and/or seperattion among married couples is looke down upon in society and is still not an acceptable phenomenon. The same applies to Muslims, Jews and Sikh, all religions people are more commited to and view divorce as deplorable. This pattern is consistent independend of different demographic and socioeconomic attributes.








### The influence of children on marriage 

When people get married they are often in love and happy, most married couples look forward to parenthood and having children could even strengthen their marital bond. However empirical study shows that the effect of children on marital stability could be very complex. Children increase the stability of marriage only when they are preschool-aged (Becker et al. 1977), as they grow older, their binding force in a marriage weakens; the greater number of children, the smaller possibility of divorce, but the relationship is inversely quadratic rather than linear suggesting the stabilizing effect is the strongest with the first and second child (Xu, Yu and Qiu 2015). 

The birth of an infant often brings couples back together who would have otherwise divorced. Experiencing divorce often place young children at risk for a variety of problems, which may persist into adulthood (Morrisox and Coiro, 1999). Therefore married couples may choose to stay in marriges for the wellbeing of their children but when children are old enough they decide to part their ways. 

Based on the Census data set the analysis explores if (1) the more children a couple have, the less likely they are to be divorced/separated (2) as the age of youngest child grows, the more likely the couple will get divorced/separated


The graph shows that the divorce rate is higher when the couple has only one child (18.5%) than having no child (10.3%), but the divorce rates decreases as they have more children (11.6% for two children and 12.7% for three and more) but still stays above couples with no kids. Testing further confirms that the difference between one child and having no child is statistically significant, which is contradictory to earlier research showing that having even the first child increases marital stability. Could children give rise to parenting conflicts that lead to divorce and separation? Possible but the Census data does not enable direct conclusions. 
However the result could be skewed: the dataset has one class under the family dependent children variable named "Persons not in a family OR persons in other related families" and they have the highest divorce rate of 81%. These people have children from a familiy they left, which explains the high divorce rate, or regard their children as having none. If those are considered as having no children and are added to the group "no children" , the pattern again is consistent with previous findings that children increase marital stability. The previously low divorce rate of people with no children grows higher than for people with children.
When not including the "Persons not in a family OR persons in other related families" as they can't be classified for sure (not enough information from the data coockbook) the Hypothesis "children lower separation rates" cannot be confirmed. Integrating the class, the Hypothesis can be confirmend. Census should clarify the latter group to make interpretation of the data possible. 


```{r}
plot_number <- fd %>% select(dpcfamuk11, binary_marstat, tenure, scgpuk11c, binary_region_factor, children_class) %>% filter(!is.na(children_class)) %>% group_by(children_class)%>% summarise(divorce_rate = mean(binary_marstat)*100)%>%ggplot(aes(x = children_class, y = divorce_rate))+ geom_col(position = 'dodge', fill = "cadetblue3") + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = 'Number of children in family', y = 'Separation rate', title = 'Excluded NA in Number of Children')

plotNA <- fd %>% select(dpcfamuk11, binary_marstat, tenure, scgpuk11c, binary_region_factor, children_class) %>% mutate(children_class_na = ifelse(is.na(children_class), '0.No children', children_class))%>% group_by(children_class_na)%>% summarise(divorce_rate = mean(binary_marstat)*100)%>%ggplot(aes(x = children_class_na, y = divorce_rate))+ geom_col(position = 'dodge', fill = "cadetblue3") + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = 'Number of children in family', y = 'Separation rate', title = 'Included NA in "no children"')

plot_age1 <- fd %>% select(dpcfamuk11, binary_marstat, tenure, scgpuk11c, binary_region_factor, children_class, youngest_child_age) %>% filter(!is.na(children_class)) %>% group_by(youngest_child_age)%>% summarise(divorce_rate = mean(binary_marstat)*100)%>%ggplot(aes(x = youngest_child_age, y = divorce_rate))+ geom_col(position = 'dodge', fill = "cadetblue3") + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = 'Youngest child age in family', y = 'Separation rate', title = 'Separation rate by youngest child age')


plot_age_number <- fd %>% select(dpcfamuk11, binary_marstat, tenure, scgpuk11c, binary_region_factor, children_class, youngest_child_age) %>% filter(!is.na(children_class)) %>% group_by(children_class, youngest_child_age)%>% summarise(divorce_rate = mean(binary_marstat)*100)%>%ggplot(aes(x = youngest_child_age, y = divorce_rate))+ geom_col(position = 'dodge', fill = "cadetblue3") + facet_wrap(~children_class)+ theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = 'Youngest child age in family by number of children')


#grid.arrange(plo, plot_age, =2)

## Dependent Children and Social Grade


plot_social <- fd %>% select(binary_marstat, tenure, scgpuk11c, binary_region_factor, children_class) %>% filter(scgpuk11c != -9) %>% filter(!is.na(children_class)) %>% group_by(scgpuk11c, children_class)%>% summarise(divorce_rate = mean(binary_marstat)*100)%>%ggplot(aes(x = scgpuk11c, y = divorce_rate, fill = children_class))+ geom_col(position = 'dodge') + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = 'Social Class')

#plot_number
#plot_social
#plotNA
grid.arrange(plot_number, plotNA, ncol=2)
plot_age1
#grid.arrange(plot_age1, plot_age, ncol = 2)
```





```{r number_children_ttest}
#t.test(fd$binary_marstat[fd$children_class == '0.No children'], fd$binary_marstat[fd$children_class == "1.One child"])
```




When looking at the age of the youngest children in each class of number of children, the divorce rate increases as the children grow older which confirms our second hypothesis. This could be related to the fact, that people first try to figure their marital problems out and think a divorce is too hard on younger childre. As children grow older, get more idependend and gain understanding for separation, parents feel more free to focus on their private lifes, think children can handle the separation better and feel less bounded to a family ideal. 

When comparing the number of children across social grades, there is no pattern found. And as two or more children decrease the likelyhood of a divorce but increase the financial burden on the parents, it can be conlcuded that financial problems direclty related to children are not affecting the divorce rate. 

```{r, include=FALSE}
family_compo <- fd%>% select(dpcfamuk11, tenure, scgpuk11c, binary_marstat, binary_region_factor) %>% mutate(no_of_children = dpcfamuk11)%>% mutate(children_class = ifelse(dpcfamuk11==1, 'No children', ifelse(dpcfamuk11==2|dpcfamuk11==3|dpcfamuk11==4|dpcfamuk11==5|dpcfamuk11==6|dpcfamuk11==7, 'One child', ifelse(dpcfamuk11==8|dpcfamuk11==9|dpcfamuk11==10|dpcfamuk11==11|dpcfamuk11==12|dpcfamuk11==13, 'Two children', ifelse(dpcfamuk11==14|dpcfamuk11==15|dpcfamuk11==16|dpcfamuk11==17|dpcfamuk11==18|dpcfamuk11==19, 'Three or more children', NA)))))

family_compo %>% select(binary_marstat, tenure, scgpuk11c, binary_region_factor, children_class) %>% filter(scgpuk11c != -9) %>% filter(!is.na(children_class)) %>% group_by(scgpuk11c, children_class)%>% summarise(divorce_rate = mean(binary_marstat))%>%ggplot(aes(x = scgpuk11c, y = divorce_rate, fill = children_class))+ geom_col(position = 'dodge') + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = 'Social Class')
```


## Health & Marriage

```{r message = FALSE, warning = FALSE, echo = FALSE}
mine <- select(fd, disability, marstat, binary_marstat)

mine$disability <- factor(mine$disability, levels = c(1,2,3), labels = c("Limited a lot", "Limited a little", "Not limited") )
mine$binary_marstat <- factor(mine$binary_marstat, levels = c(0,1), labels = c("married", "divorced"))
mine2 <- select(fd, disability, marstat, binary_marstat, scgpuk11c)
mine2 <- mine2[mine2$scgpuk11c != -9,]
mine2$disability <- factor(mine2$disability, levels = c(1,2,3), labels = c("Limited a lot", "Limited a little", "not limited") )
mine2 <- mine2 %>% group_by(disability,scgpuk11c) %>% mutate(divorce_rate = mean(binary_marstat))
mine2 <- mine2[complete.cases(mine2),]

mine3 <- mine2 %>% group_by(disability) %>% summarise(divorce_rate = mean(binary_marstat))
```

Long-term health has long been speculated to be critical factor for a satisfactory life, this also translates to health being an important factor in eding marriages. There are three levels of health indicators in this dataset: "Limited a lot", "Limited a little", and "Not limited". Each level represents the degree of daily activities a person is limited to because of his or her long-term illnesses. The percentage of  people falling under this category is 8.5%, 9.4%, and 82.1% for "Limited a Lot", "Limited a little", and "Not limited" respectively.

```{r echo = FALSE, include=FALSE}
chisq.test(mine$binary_marstat,mine$disability)
```


```{r echo = FALSE, fig.width=4,fig.height=4, health_plot1}

ggplot(mine3, aes(disability, divorce_rate*100))+geom_bar(stat = "identity")+geom_col(fill = "cadetblue3")+labs(x = "Health", y = "Separation Rate (%)")
```


The plot illustrates health's observable impact on the separation rate. The trend shown below clearly exhibits an inverse relationship between ones health status and the separation rate. This result is consistent with the common notion that health issues create a burden on the family unit, which leads to the termination of marriages. 


```{r echo = FALSE ,fig.width=4,fig.height=4, health_plot2}
#ggplot(mine2, aes(factor(scgpuk11c), divorce_rate*100, fill = disability))+geom_bar(stat = "identity", position = "dodge") + labs(x = "Social Grade", y = "Separation Rate (%)")
```


To validate this finding, it is important to examine the relationship between social grade and health via separation rates. According to the plot within each social grade, the impact of disability on health is very strong. Therefore, it can be concluded that the variable health has a real and observable impact on marital status, independly of social grade and therefore better or worse access to healthcare. The more severe the health problem, the higher the separation rate and that across all social grades.

Furthermore, othe published material seems to support this trend. A report by Time states that 75% of couples dealing with chronic disease end in divorce (Sifferlin, 2017). 


#Unrelated findings

Additionaly to the explored variables above, a few other possible influence factors have been explored including hours worked, type of housing, distance from home to work and transport to work. They do not show any obvious relationships with separation rate. Firstly contradictory to our common belief that long working hours affect marriage adversely, however that's not observed in the data, the highest divorce rate is observed in the 16-30 hours per week band. The higher salary brought by longer working hours could have improved the couples' relationships in the marriage. As the Census date does not include the varibale salary and the overall pattern of work hours is constistent over social grades, no conclusion can be drawn. 
Secondly owning a property gives the marriage much more stability then renting, partly due to the troubles related to property ownership when marriages are dissolved. In the Census data, highest separation rate is observed among people who live in rented properties. However it is probable that living in a rented property is a result of the separation rather than the cause of it. Thirdly following reports that the longer the time an individual takes to travel from home to work, the lower the happiness index, it was expected to find that the further one stays from his/her work, and the least efficient the transport method is, the higher the separation rate. However the data did not show any pattern supporting this assumption. Interestingly, a significanlty higher percentage of people are separated from their spouses among people who commute by bus. This deserves further research. 

```{r, include=FALSE}

#divorce rate by hours worked
fd %>% filter(!is.na(hours)) %>%group_by(hours) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = hours, y = divorce_rate))+ geom_col() + theme(axis.text.x = element_text(angle = 60, hjust = 1))  

#divorce rate by tenure
fd %>% filter(!is.na(tenure)) %>%group_by(tenure) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = tenure, y = divorce_rate))+ geom_col() + theme(axis.text.x = element_text(angle = 60, hjust = 1)) 

#divorce rate by distance to work
fd %>% filter(!is.na(wpzhome)) %>%group_by(wpzhome) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = wpzhome, y = divorce_rate))+ geom_col() + theme(axis.text.x = element_text(angle = 60, hjust = 1))  

fd %>% filter(!is.na(transport)) %>%group_by(transport) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = transport, y = divorce_rate))+ geom_col() + theme(axis.text.x = element_text(angle = 60, hjust = 1))  


```



# Logistic Regression
A comprehensive regression analysis of all correlated variables

## Methodology
The variables presented thus far in this paper are the variables hypothesised to have the greatest effect on a person's likliness of being divorced in a certain society.
As the dependant variable in question is a dichotomous variable (divorced or not divorced), a logistic regression was performed where the divorced status is the dependant variable, and the variables mentioned throughout this paper are the independant variables.
The goal behind this model is to predict the probability of a binary response (divorced or not) based on a set of other variables.



The model includes 8 variables that were experimented with to find the best overall fit:
1. Social Grade
2. Education
3. Age
4. Religion
5. Health
6. Number of Children
7. Ethnicity
8. Whether the person lives in London

The best fit was determined by including and excluding different variables until the best combination of the aforementioned variables was obtained. 



As a measure of the overall model's explanatory power, two main measures were use:
1) c-statistic or AUC (area under ROC curve)
2) The accuracy of the predictions above a certain threshold (the mean divorce rate for our purposes)


In addition, the multicollinearity of the model was tested to examine its validity. The logistic regression was performed thusly: The original dataset was partitioned into 70% training data, on which the regression was performed, and 30% testing data, on which the prediction accuracy was tested.

```{r echo = FALSE}
census <- fd

census$ethnicityew <- factor(census$ethnicityew, levels = seq(1,18), labels = c("English/Welsh/Scottish/Northern Irish/British", 
"Irish", 
"Gypsy or Irish Traveller", 
"Other White", 
"Mixed/multiple ethnic group: White and Black Caribbean", 
"Mixed/multiple ethnic group: White and Black African", 
"Mixed/multiple ethnic group: White and Asian", 
"Mixed/multiple ethnic group: Other Mixed", 
"Indian", 
"Pakistani", 
"Bangladeshi", 
"Chinese", 
"Other Asian", 
"African", 
"Caribbean", 
"Other Black", 
"Arab", 
"Any other ethnic group"))

#1: white 2: Asian 3: black 4: Arab 5: other
census$ethngrouped <- census$ethnicityew
census$ethngrouped <- ifelse(census$ethnicityew == "English/Welsh/Scottish/Northern Irish/British"  | census$ethnicityew == "Irish" | census$ethnicityew == "Gypsy or Irish Traveller"| census$ethnicityew == "Other White", 1,       ifelse( census$ethnicityew == "Indian" | census$ethnicityew == "Pakistani"| census$ethnicityew == "Bangladeshi" | census$ethnicityew == "Chinese"| census$ethnicityew == "Other Asian", 2, 
                                        ifelse(census$ethnicityew == "African" | census$ethnicityew == "Caribbean"| census$ethnicityew == "Other Black", 3, 
                                               ifelse(census$ethnicityew == "Arab", 4, 
                                                      ifelse(census$ethnicityew == "other", "Any other ethnic group", 5)))))

```


```{r echo = FALSE, warning= FALSE}
lr <- select(filtered_data, caseno, disability, marstat, hlqupuk11, scgpuk11c, religionew, age, region)
lr$separated <- lr$marstat
lr <- lr %>% mutate(separated = replace(separated, marstat == 2 | marstat == 3, 0))
lr <- lr %>% mutate(separated = replace(separated, marstat == 5 | marstat == 4, 1))
lr <- lr %>% mutate(london = ifelse(region == 10, 1, 0))
colnames(lr) <- c("ID", "disability", "marstat", "education", "social_grade", "religion", "age", "region", "separated", "london")
#replace -9 with NA 
lr <- lr %>% mutate_all(funs(replace(., . == -9, NA)))
lr <- lr %>% filter(!is.na(social_grade), !is.na(education), !(education == 16), !is.na(religion))

```

```{r echo = FALSE}
# Create training and validation dataset

input_ones <- lr[which(lr$separated == 1), ]  # all 1's
input_zeros <- lr[which(lr$separated == 0), ]  # all 0's
set.seed(100)  # for repeatability of samples
input_ones_training_rows <- sample(1:nrow(input_ones), 0.7*nrow(input_ones))  # 1's for training
input_zeros_training_rows <- sample(1:nrow(input_zeros), 0.7*nrow(input_zeros))  # 0's for training. Pick as many 0's as 1's
training_ones <- input_ones[input_ones_training_rows, ]  
training_zeros <- input_zeros[input_zeros_training_rows, ]
trainingData <- rbind(training_ones, training_zeros)  # row bind the 1's and 0's 

# Create Test Data
test_ones <- input_ones[-input_ones_training_rows, ]
test_zeros <- input_zeros[-input_zeros_training_rows, ]
testData <- rbind(test_ones, test_zeros)  # row bind the 1's and 0's 
```


```{r message = FALSE, echo = FALSE, results = "hide", warning = FALSE}

library(smbinning)
library(InformationValue)

# use training data to train the model
#lin_mo1 <- glm(separated ~ social_grade + education + religion + age + london + children + ethnicity, data = trainingData, family = binomial)
#lin_mo2 <- glm(separated ~ social_grade + education + religion + age + london + disability + children +ethnicity, data = trainingData, family = binomial)
lin_mo1 <- glm(separated ~ social_grade + education, data = trainingData, family = binomial)
lin_mo2 <- glm(separated ~ social_grade + education + age, data = trainingData, family = binomial)

lin_mo3 <- glm(separated ~ social_grade + education + disability, data = trainingData, family = binomial(link = "logit"))
lin_mo4 <- glm(separated ~ social_grade + education + disability + age, data = trainingData, family = binomial(link = "logit"))
lin_mo5 <- glm(separated ~ social_grade, data = trainingData, family = binomial(link = "logit"))


# create predicted values and un-log it.
predicted1 <- predict(lin_mo1, testData, type = "response")
predicted2 <- plogis(predict(lin_mo2, testData))
predicted3 <- plogis(predict(lin_mo3, testData))
predicted4 <- plogis(predict(lin_mo4, testData))
predicted5 <- predict(lin_mo5, testData, type = "response")

# check for misclassification error
#misClassError(testData$separated, predicted1)
# 0.4311, It should be a value between 0 and 1, the lower the better
#misClassError(testData$separated, predicted2)
#misClassError(testData$separated, predicted3, threshold = Cutoff)
#misClassError(testData$separated, predicted4)
#misClassError(testData$separated, predicted5)


#plotROC(testData$separated, predicted5)
#plotROC(testData$separated, predicted4)
#plotROC(testData$separated, predicted3)
#plotROC(testData$separated, predicted2)
#plotROC(testData$separated, predicted1)

#library(stargazer)
#stargazer(list(lin_mo1,lin_mo2, lin_mo3),type = "text")
```
Based on this analysis, the best model fit includes 4 of the 8 variables: Social grade, Education, Health, and Age.

## ROC Curve
The model's accuracy is calculated next by comparing the predicted results to actual results. The predicted results were assigned a binary response of 1(i.e. divorced) if the predicted value is above the mean divorce rate of the test data and vice versa. The resulting accuracy of the model was calculated at 58.89% indicating a correct response of around 59 times out of 100 predictions.

```{r echo = FALSE}
lin_mo4 <- glm(separated ~ social_grade + education + disability + age , data = trainingData, family = binomial(link = "logit"))
predicted4 <- plogis(predict(lin_mo4, testData))
#misClassError(testData$separated, predicted4)
plotROC(testData$separated, predicted4)
```


## Accuracy
Next, we calculate the model's accuracy by comparing it to the mean of the test dataset. The result indicates that the accuracy rate is 58.89%. The accuracy rate tells us how accurate our predicted result compared to the actual result is. Our model will get about 59 correct results within 100 examples. 

```{r}
# Calculate the model's accuracy
pred <- ifelse(predicted4 > mean(as.numeric(testData$separated)), 1, 0)
mean(testData$separated == pred)
```

## Multicollinearity
Finally, we examined the multicollinearity in the model by using the Variance Inflation Factor. According to the result below, all indicators are very close to 1 and well below 5. Therefore, all predictors within this particular logistic regression are not linearly related. We can safely conclude that the multicollinearity is very low and the model is valid.

```{r echo = FALSE, warning = FALSE, message = FALSE}
# check for multicollinearity
library(car)
vif(lin_mo4) 
# as long as all values are below 4, it is fine, no big deal
```

## Limitation
The evidence presented above seems to suggest that the model is valid, yet the accuracy of the latter does not seem to outperform an arbitrary prediction of 0's accross the board(i.e. prediction of not divorced for all observations), this yields a prediction rate equal to 1-divorce rate, which is higher than the model's predictive power. Likely casues of this issue maybe the exclusion of other factors that may affect marital status from the model.

## Conclusion of model
Nevertheless, the findings presented above were identified as strong drivers of divorces in the UK. Among the variables considered, the regression suggests that Social grade, education, health, and age are among the strongest predictors of divorced status. 


#  Final conclusion

This paper has examined variables hypothesised to affect divorce rates in the UK. According to the analysis performed above, it is evident that divorce rates have multiple determinant factors, which themselves are potentially co-dependant. This analysis does not attempt to single out a specific variable or group of variables as the main determinant of divorce rate, but examines potential affecting variables. The findings of the analysis presented seem to suggest that the four variables below have the strongest predictive power vis a vis divorced status, as they apply to the majority of the population.

Lacking any information about a particular person, age would be a good first predictor of marital status. It has been shown that people in their 40's have the highest divorce rates in society. This is true across different demographic groups.

It is evident that social class and education level are amongst the biggest influencing factors of divorce rate as depicted by the strong inverse relationship of these variables with divorce rates. Affluence and welath are strongly linked to ones social class and education level with the latter and the former also closely linked, this supports the common beleif that financial security and wealth will likely act as a mitigating factor for divorce and cause more people to stay in marriages. This trend holds true accross all ethnicities and religions, which further suppports the strength of the variables. Social problems stated above stornlgy related to social grades and education put a strong burden on marriages and lead to a higher separation rate. 

The different sepraration patterns between religions differ depending on how commited people are in geenral to their religion and how involving the religion is. Especially religions where divorce is still tabood the separation rate will remain low.

The results presented in this analysis are by no means an exhaustive list of factors affecting divorce rates, as divorce is an extremely complex phenomenon which may be triggered by a plethora of variables. It is apparent that, as societies develop and cultural beleifs change, the institution of marriage, and therefore the instances of divorce will surely develop and change themselves.

# References

Main Github Repository: https://github.com/dlouhasha/TheGreatWork

Adam Isen, Betsey Stevenson (2010). Women's Education and Family Behavior: Trends in Marriage, Divorce and Fertility. *Nber Working Paper Series*, No.15725. Available from: [DOI: 10.3386/w15725] (Accessed on 11 October 2017)

Aida Edemariam, The Guardian (2014). *Divorced by 30: why do so many young marriages come to an early end?*. Available from: [https://www.theguardian.com/lifeandstyle/2014/dec/19/-sp-why-do-so-many-young-marriages-come-to-an-early-end] (Accessed on 12 October 2017)

Alexander Hagelüken, Suddeutsche Zeitung (2014) *Heiraten zementiert soziale Spaltung*, Available from: [http://www.sueddeutsche.de/wirtschaft/partnerwahl-und-ungleichheit-heiraten-zementiert-soziale-spaltung-1.1875581] (Accessed on 12 October 2017)

Anushka Asthana and Denis Campbell, The Guardian (2009) *US study says divorce is linked to age and education*. Available from: [https://www.theguardian.com/lifeandstyle/2009/sep/27/divorce-linked-to-age-education] (Accessed on 11 October 2017)

Becker, Gary S., Elizabeth Landes, and Robert T. Michael (1977) An Economic Analysis of Marital Instability. *Journal of Political Economy*, 85:1141-87. 

Donna Ruane Morrisox and Mary Jo Coiro, Parental Conflict and Marital Disruption: Do Children Benefit When High-Conflict Marriages Are Dissolved?. Journal of Marriage and the Family 6 1 (August 1999): 626-637

Chloe Pantazi, Thrillist (2015) *Where are the Tinder users trying to get laid the most?*. Available from:[thttps://www.thrillist.com/travel/nation/where-tinder-passport-users-are-swiping-the-most] (Accessed on 12 October 2017)

Divorcesource (2016) Interracial Marriage and Divorce. Available from: [http://www.divorcesource.com/blog/interracial-marriage-and-divorce/]. (Accessed on 11 October 2017)

Donna Ruane Morrisox and Mary Jo Coiro (1999) Parental Conflict and Marital Disruption: Do Children Benefit When High-Conflict Marriages Are Dissolved?. *Journal of Marriage and the Family* 6(1), 626-637

Hlavac, Marek (2015). stargazer: Well-Formatted Regression and Summary Statistics Tables. *R package version 5.2*. Available from:[http://CRAN.R-project.org/package=stargazer] (Accessed on 12 October 2017)
 
James Meikle, The Guardian (2013) *Divorces on rise among over-60s*. Available from: [https://www.theguardian.com/lifeandstyle/2013/aug/06/divorces-rise-over-60s
] (Accessed on 12 October 2017)

Jan D. Andersen (2005) Financial Problems and Divorce - Do Demographic Characteristics Strengthen the Relationship?. *Journal f Divorce & Remarriage*, 43(1-2), 149-161. Available from: doi: 10.1300/J087v43n01_08 (Accessed on 12 October 2017)

John Bingham and Ashley kirk, The Telegraph (2015), *Divorce rate at lowest level in 40 years after cohabitation revolution*. Available from: [http://www.telegraph.co.uk/news/uknews/12011714/Divorce-rate-at-lowest-level-in-40-years-after-cohabitation-revolution.html] (Accessed on 12 October 2017)

NHS Digital (2014) *Statistics on Drugs Misuse: English, 2014* Available from: [http://digital.nhs.uk/catalogue/PUB15943] (Accessed on 11 October 2017)

Office for National Statistics (2015) *Births by parents' characterisitics in England and Wales：2015*. Available from: [https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/livebirths/bulletins/birthsbyparentscharacteristicsinenglandandwales/2015] (Accessed on 12 October 2017)

Office for National Statistics (2015) *Divorces in England and Wales: 2015 - Dissolutions and annulments of marriage by previous marital status, sex, age, fact proven and to whom granted*. Available from: [https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/divorce/bulletins/divorcesinenglandandwales/2015] (Accessed on 12 October 2017) 

Office for National Statistics (2017) *Marriage and divorce on the rise at 65 and over*. Available from: [https://visual.ons.gov.uk/marriage-and-divorce-on-the-rise-at-65-and-over/] (Accessed on 12 October 2017)

Qi Xu, Jianning Yu and Zeqi Qiu (2015) The impact of children on divorce risk. *The Journal of Chinese Sociology*, 2(1). Available from: DOI 10.1186/s40711-015-0003-0 (Accessed on 12 October 2017)

Prince Evans Solicitors LLP (2017) *Divorce rate highest among those aged 40 to 49*. Available from: [http://www.prince-evans.co.uk/2017/01/divorce-rate-highest-among-aged-40-49/
] (Accessed on 12 October 2017)

Sedghi, A. and Arnett, G. (2017). [online] Available at: [14:32, 10/13/2017] +44 7422 960814: https://www.theguardian.com/news/datablog/2014/feb/12/how-does-commuting-affect-wellbeing [Accessed 13 Oct. 2017].

Sifferlin, A. (2017). Till death do us part—unless it's the wife who gets sick. [online] Time.com. Available at: http://time.com/83486/divorce-is-more-likely-if-the-wife-not-the-husband-gets-sick/ [Accessed 13 Oct. 2017].

Susan L. Brown and I-Fen Lin (2012). The Gray Divorce Revolution: Rising Divorce Among Middle-Aged and Older Adults, 1990-2010. *The Journals of Gerontology*, 67(6), 731-741. Available from: doi: 10.1093/geronb/gbs089 (Accessed on 12 October 2017)

Thomas E.Trail, Benjamin R. Karney (2012). What's (Not) Wrong With Low-Income Marriages. *Journal of Marriage and Family*, 74(3), 413-427. Available from: DOI: 10.1111/j.1741-3737.2012.00977.x (Accessed on 11 October 2017)

U.K. - Daily Mail (2015) *Wish you weren't here: Top ten divorce hot spots across Britain are all by the sea - with Blackpool the worst place to live if you want a happy marriage*. Available from: [http://www.dailymail.co.uk/news/article-3201497/Wish-weren-t-ten-divorce-hot-spots-Britain-sea-Blackpool-worst-place-live-want-happy-marriage.html]. (Accessed on 11 October 2017)

Waite, Linda J, and Lee A Lillard (1991) Children and marital disruption. *American Journal of Sociology*, 96(4):930–953. 

Wendy D. Manning (1993) Marriage and Cohabitation following Premarital Conception. *Journal of Marriage and Family*, 55(4), 839-850

Wendy Wang, Pew Research Center (2015) *The link between a college education and a lasting marriage*. Available from: [http://www.pewresearch.org/fact-tank/2015/12/04/education-and-marriage/] (Accessed on 12 October 2017) 
